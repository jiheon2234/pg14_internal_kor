

## 1.1  데이터 구조

### **Databases**

PostgreSQL은 데이터베이스 관리 시스템에 속하는 프로그램임. 프로그램이 실행중일때 이걸*POSTGRESQL server, instance*라고 함.

PostgreSQL이 관리하는 데이터는 데이터베이스에 저장됨. 하나의 PostgreSQL 인스턴스는 동시에 여러 데이터베이스를 제공할 수 있으며 ; 이를 *database cluster* 라고 함.

cluster를 사용하기 위해선, 먼저 초기화해야 함. cluster와 관련된 모든 파일이 저장되는 데이터 디렉토리는 환경변수 `PG_DATA`가 가리키는 경로임.

> 미리 빌드된 패키지에서 설치할 경우, 유틸리티에서 필요한 모든 매개변수를 명시적으로 설정하여 POSTGRESQL 기본 매커니즘 위에 "추상화 레이어" 를 설정할 수 있음. 이 경우에 데이터베이스 서버는 운영 체제 서비스로 실행되며, 님 `PGDATA`를 직접 마주할 일이 없음. 
> 하지만, 용어 자체는 널리 사용되기 때문에, 계속 이를 사용할 거임.


cluster가 생성된 후, `PGDATA`는 다음과 같은 3가지 데이터베이스가 포함됨.

-  **template0** 논리적 백업에서 데이터를 복구하거나, 다른 인코딩으로 된 데이터를 생성하는데 사용된다; 이건 절대 변경 ❌.
 
- **template1** 사용자가 cluster에서 만들 수  있는 다른 모든 데이터베이스의 템플릿 역활을 함.

-  **postgres** 유저 맘대로 사용가능한 일반 데이터베이스.

![](_static/CleanShot%20-000052.png)

<br>

### **System Catalog**

모든 cluster object( 테이블, 인덱스, 데이터타입, function 등)은 *system catalog* 테이블에 저장됨. 각 데이터베이스는 자기의 객체들을 설명하는 자신만의 고유한 테이블 집합( 뷰도)을 가짐.
몇몇의 *system catalog*테이블들은 모든 cluster에서 공통으로 사용됨; 특정 데이터베이스에 속하지 않지만(기술적으로, ID가 0인 더미 데이터베이스가 사용됨) 모든 데이터베이스에 접근 가능

*system catalog*는 일반 SQL쿼리로 조절할 수 있으며, 모든 변경은 DDL 명령어에 의해 수행됨.
*psql* 클라이언트는 *system catalog*의 내용을 나타내는 다양한 명령어를 제공함.

모든 *system catalog* 테이블을 `pg_`로 시작됨  (*ex: pg_database*)  컬럼 이름은 보통 테이블 이름과 연관된 3글자 접두어로 시작됨 (*ex: dataname *)

모든 시스템 카탈로그 테이블에서, PK는 **32비트 정수형**인 `oid`라고 함(object identifier); 

> `oid`의 구현은 시퀀스와 거의 동일하지만, Postgres에서 먼져 등장함. `oid`를 특별하게 만드는건, 공통 카운터에서 생성된 고유 ID가 시스템 카탈로그의 서로 다른 테이블에서  사용된다는 것임.
> 할당된 ID가 최댓값을 초과할때, 카운터는 리셋됨. 특정 테이블 내부에서 모든 값이 고유하다는 것을 보장하기 위해,  다음 `oid`는 고유 인덱스로 확인됨. 만일 테이블에서 이미 사용되고 있다면, 카운터가 증가하고 다시 체크함



### **Schemas**

`Schemas` 는 데이터베이스의 모든 객체를 저장하는 namespace임. 유저 스키마 말고도, Postgres는 미리 정의된 스키마가 있음

- **pulibc**은 다른 설정이 없으면 사용자 객체에 대한 기본 스키마임
- **pg_catalog**는 시스템 카탈로그 테이블에 사용됨
- **information_schema**는 SQL 표준문법으로 정의된 시스템 카탈로그에 대한  *view*임
- **pg_toast**는 대형 객체와 관련된 항목에 사용됨 (text 타입등) **프로그래밍 heap 생각**
- **pg_temp**는 임시 테이블을 포함함. 서로 다른 사용자가 pg_temp_*N(세션번호)* 에 임시 테이블을 생성하면, `pg_temp` 별칭으로 자신의 오브젝트를 참조할 수 있음

하나의 데이터베이스에는 여러 스키마가 있을 수 있으며, 모든 데이터베이스 객체는 스키마에 속해야됨

객체에 접근할때 특정 스키마를 지정하지 않으면, Postgres는 검색 경로에서 처음으로 적합한 스키마를 선택함.
검색 경로는 암묵적으로 `search-path` 파라미터에 기반하며, 여기에는 *pg_catalog*와 (가능하다면) *pg_temp* 스키마가 자동으로 추가됨. 이는 서로 다르 스키마가 같은 이름을 가진 객체를 포함할 수 있다는 뜻임.





