
페이지 유형의 *heavyweight lock* [^1]는 *GIN* 인덱스에서만 다음과 같은 경우에만 적용된다.

*GIN* 인덱스는 텍스트 문서에서 단어를 찾는 것과 같은 복합 값의 요소 검색 수준을 높일수 있다.  대충 전체 문서가 아닌 개별 단어를 저장하는 B-tree와 유사하다고 설명할 수 있다.
새 문서가 추가되면, 해당 문서에 나오는 각 단어를 포함하도록 인덱스가 철저하게 업데이트되어야 한다.

성능을 개선하기 위해 GIN 인덱스는 지연된 삽입을 허용하며, *fastupdate* 스토리지 파라미터에 의해 제어된다.
새로운 단어는 처음에 빠르게 정렬되지 않은 대기 리스트에 추가되며, 일정 시간이 지나면 모든 누적된 항목이 메인 인덱스 구조로 이동한다.
서로 다른 문서에 중복된 단어가 포함될 가능성이 매우 높기 때문에, 이는 매우 비용 효율적이다.

여러 프로세스가 동시에 단어를 옮기는 것을 방지하기 위해, 대기 목록에서 메인 인덱스로 모든 단어가 이동할 때 까지, 인덱스 메타페이지는 베타적 모드로 잠긴다. 이 잠금은 일반적인 인덱스 사용에는 영향을 미치지 않는다.

relation extension locks 마찬가지로, 페이지 잠금은 작업이 완료되면 즉시 해제되며, 트랜잭션이 끝날 때 까지 기다리지 않으므로 데드락이 일어나지 않는다.





[^1]:[backend/storage/lmgr/lmgr.c, LockPage function](https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/storage/lmgr/lmgr.c;hb=REL_14_STABLE)